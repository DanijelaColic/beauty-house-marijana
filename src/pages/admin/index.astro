---
import BaseLayout from '@/layouts/BaseLayout.astro';
import AdminLayout from '@/components/admin/AdminLayout';
import BookingsList from '@/components/admin/BookingsList';

// Check if user is authenticated
const sessionCookie = Astro.cookies.get('staff_session');

if (!sessionCookie) {
  return Astro.redirect('/admin/login');
}

// Verify session
try {
  const sessionCheck = await fetch(`${Astro.url.origin}/api/auth/session`, {
    headers: {
      'Cookie': `staff_session=${sessionCookie.value}`,
    },
  });
  
  if (!sessionCheck.ok) {
    return Astro.redirect('/admin/login');
  }
} catch (err) {
  console.error('Session check error:', err);
  return Astro.redirect('/admin/login');
}
---

<BaseLayout
  title="Admin Panel | Beauty House Marijana"
  description="Admin panel za upravljanje rezervacijama"
>
  <AdminLayout client:load>
    <div class="space-y-6">
      <div>
        <h2 class="text-2xl font-bold text-gray-900">Rezervacije</h2>
        <p class="text-gray-600 mt-1">
          Pregled svih rezervacija i upravljanje terminima
        </p>
      </div>

      <BookingsList client:load />
    </div>
  </AdminLayout>
</BaseLayout>

